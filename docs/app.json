[{"name":"app.R","content":"library(shiny)\r\nlibrary(ggplot2)\r\nlibrary(dplyr)\r\n\r\nui <- fluidPage(\r\n  titlePanel(\"Deckungsbeitragsrechnung – Handwerkerauftrag\"),\r\n  sidebarLayout(\r\n    sidebarPanel(\r\n      numericInput(\"umsatz\", \"Umsatz (CHF)\", value = 100000, min = 0),\r\n      \r\n      # Variable Kosten\r\n      h4(\"Variable Kosten\"),\r\n      numericInput(\"materialkosten\", \"Materialkosten (CHF)\", value = 25000, min = 0),\r\n      numericInput(\"arbeitsstunden\", \"Arbeitsstunden\", value = 160, min = 0),\r\n      numericInput(\"stundensatz\", \"Stundensatz (CHF)\", value = 45, min = 0),\r\n      numericInput(\"entfernung\", \"Entfernung (km)\", value = 50, min = 0),\r\n      numericInput(\"benzinpreis\", \"Benzinpreis pro km (CHF)\", value = 0.35, min = 0),\r\n      numericInput(\"fahrten\", \"Anzahl der Fahrten\", value = 20, min = 0),\r\n      \r\n      # Fixkosten\r\n      h4(\"Fixkosten\"),\r\n      numericInput(\"opportunitaetskosten\", \"Opportunitätskosten pro Tag (CHF)\", value = 200, min = 0),\r\n      numericInput(\"projekttage\", \"Projektdauer (Tage)\", value = 20, min = 0),\r\n      numericInput(\"verwaltung\", \"Verwaltungskosten (CHF)\", value = 2000, min = 0),\r\n      numericInput(\"versicherung\", \"Versicherungskosten (CHF)\", value = 1500, min = 0)\r\n    ),\r\n    mainPanel(\r\n      h3(\"Ergebnis\"),\r\n      verbatimTextOutput(\"dbr_summary\"),\r\n      br(),\r\n      h4(\"Wasserfalldiagramm (DBR)\"),\r\n      plotOutput(\"dbr_plot\", height = \"400px\"),\r\n      br(),\r\n      h4(\"Kostenaufstellung\"),\r\n      tableOutput(\"kostentabelle\")\r\n    )\r\n  )\r\n)\r\n\r\nserver <- function(input, output) {\r\n  \r\n  variable_kosten <- reactive({\r\n    arbeitskosten <- input$arbeitsstunden * input$stundensatz\r\n    transportkosten <- input$entfernung * input$benzinpreis * input$fahrten\r\n    \r\n    list(\r\n      Materialkosten = input$materialkosten,\r\n      Arbeitskosten = arbeitskosten,\r\n      Transportkosten = transportkosten\r\n    )\r\n  })\r\n  \r\n  fixe_kosten <- reactive({\r\n    oppkosten <- input$opportunitaetskosten * input$projekttage\r\n    \r\n    list(\r\n      Opportunitätskosten = oppkosten,\r\n      Verwaltungskosten = input$verwaltung,\r\n      Versicherungskosten = input$versicherung\r\n    )\r\n  })\r\n  \r\n  deckungsbeitrag <- reactive({\r\n    input$umsatz - sum(unlist(variable_kosten()))\r\n  })\r\n  \r\n  betriebsergebnis <- reactive({\r\n    deckungsbeitrag() - sum(unlist(fixe_kosten()))\r\n  })\r\n  \r\n  output$dbr_summary <- renderPrint({\r\n    cat(\"Umsatz:\", format(input$umsatz, big.mark = \"'\"), \"CHF\\n\")\r\n    cat(\"Variable Kosten:\", format(sum(unlist(variable_kosten())), big.mark = \"'\"), \"CHF\\n\")\r\n    cat(\"Deckungsbeitrag:\", format(deckungsbeitrag(), big.mark = \"'\"), \"CHF\\n\")\r\n    cat(\"Fixkosten:\", format(sum(unlist(fixe_kosten())), big.mark = \"'\"), \"CHF\\n\")\r\n    cat(\"Betriebsergebnis:\", format(betriebsergebnis(), big.mark = \"'\"), \"CHF\")\r\n  })\r\n  \r\n  output$dbr_plot <- renderPlot({\r\n    umsatz <- input$umsatz\r\n    vk <- sum(unlist(variable_kosten()))\r\n    db <- deckungsbeitrag()\r\n    fk <- sum(unlist(fixe_kosten()))\r\n    ergebnis <- betriebsergebnis()\r\n    \r\n    df <- data.frame(\r\n      Kategorie = factor(c(\"Umsatz\", \"Variable Kosten\", \"Deckungsbeitrag\", \"Fixkosten\", \"Betriebsergebnis\"),\r\n                         levels = c(\"Umsatz\", \"Variable Kosten\", \"Deckungsbeitrag\", \"Fixkosten\", \"Betriebsergebnis\")),\r\n      Wert = c(umsatz, -vk, NA, -fk, ergebnis),\r\n      start = c(0, umsatz, NA, NA, 0),\r\n      end = c(umsatz, umsatz - vk, NA, NA, ergebnis)\r\n    )\r\n    \r\n    df$start[3] <- df$end[2]\r\n    df$end[3] <- df$start[3]\r\n    df$start[4] <- df$end[3]\r\n    df$end[4] <- df$start[4] - fk\r\n    \r\n    ggplot(df, aes(x = Kategorie)) +\r\n      geom_rect(aes(xmin = as.numeric(Kategorie) - 0.45,\r\n                    xmax = as.numeric(Kategorie) + 0.45,\r\n                    ymin = pmin(start, end),\r\n                    ymax = pmax(start, end),\r\n                    fill = Kategorie)) +\r\n      geom_text(aes(y = pmax(start, end), \r\n                    label = format(round(abs(end - start)), big.mark = \"'\", scientific = FALSE)),\r\n                vjust = -0.5) +\r\n      geom_hline(yintercept = 0) +\r\n      scale_fill_manual(values = c(\r\n        \"Umsatz\" = \"#3498db\",\r\n        \"Variable Kosten\" = \"#e74c3c\",\r\n        \"Deckungsbeitrag\" = \"#2ecc71\",\r\n        \"Fixkosten\" = \"#f39c12\",\r\n        \"Betriebsergebnis\" = ifelse(ergebnis >= 0, \"#27ae60\", \"#c0392b\")\r\n      )) +\r\n      theme_minimal() +\r\n      theme(\r\n        axis.text.x = element_text(angle = 45, hjust = 1),\r\n        legend.position = \"none\",\r\n        panel.grid.major.x = element_blank()\r\n      ) +\r\n      labs(\r\n        title = \"Deckungsbeitragsrechnung\",\r\n        x = \"\",\r\n        y = \"CHF\"\r\n      )\r\n  })\r\n  \r\n  output$kostentabelle <- renderTable({\r\n    vk <- variable_kosten()\r\n    fk <- fixe_kosten()\r\n    \r\n    kosten_df <- data.frame(\r\n      Kategorie = c(names(vk), names(fk)),\r\n      Typ = c(rep(\"Variable Kosten\", length(vk)), rep(\"Fixkosten\", length(fk))),\r\n      Betrag = c(unlist(vk), unlist(fk)),\r\n      stringsAsFactors = FALSE\r\n    )\r\n    \r\n    kosten_df$Betrag <- format(kosten_df$Betrag, big.mark = \"'\", decimal.mark = \".\", nsmall = 2)\r\n    \r\n    colnames(kosten_df) <- c(\"Kostenkategorie\", \"Typ\", \"Betrag in CHF\")\r\n    \r\n    kosten_df\r\n  })\r\n}\r\n\r\nshinyApp(ui, server)\r\n","type":"text"},{"name":"baukosten.Rproj","content":"Version: 1.0\r\n\r\nRestoreWorkspace: Default\r\nSaveWorkspace: Default\r\nAlwaysSaveHistory: Default\r\n\r\nEnableCodeIndexing: Yes\r\nUseSpacesForTab: Yes\r\nNumSpacesForTab: 2\r\nEncoding: UTF-8\r\n\r\nRnwWeave: Sweave\r\nLaTeX: pdfLaTeX\r\n","type":"text"}]
